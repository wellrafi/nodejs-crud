<%- include('../../partials/header.ejs') %>

<!-- Page Wrapper -->
<div id="wrapper">
	<%- include('../../partials/sidebar.ejs') %>

	<!-- Content Wrapper -->
	<div id="content-wrapper" class="d-flex flex-column">
		<!-- Main Content -->
		<div id="content">
			<%- include('../../partials/navbar.ejs') %>

			<!-- Begin Page Content -->
			<div class="container-fluid">
				<%- include('../../partials/message.ejs') %>

				<!-- Page Heading -->
				<h1 class="h3 mb-4 text-gray-800"><%= item.title %></h1>

				<nav>
					<div class="nav nav-tabs" id="nav-tab" role="tablist">
						<a
							class="nav-item nav-link"
							id="detail-item-tab"
							data-toggle="tab"
							href="#detail-item"
							onclick="pushUrl('detail')"
							role="tab"
							aria-controls="detail-item"
							aria-selected="false"
							>Detail</a
						>
						<a
							class="nav-item nav-link"
							id="image-item-tab"
							data-toggle="tab"
							href="#image-item"
							onclick="pushUrl('image')"
							role="tab"
							aria-controls="image-item"
							aria-selected="false"
							>Images</a
						>
						<a
							class="nav-item nav-link"
							id="feature-item-tab"
							data-toggle="tab"
							href="#feature-item"
							onclick="pushUrl('feature')"
							role="tab"
							aria-controls="feature-item"
							aria-selected="false"
							>Feature</a
						>
						<a
							class="nav-item nav-link"
							id="activity-item-tab"
							data-toggle="tab"
							href="#activity-item"
							onclick="pushUrl('activity')"
							role="tab"
							aria-controls="activity-item"
							aria-selected="false"
							>Activity</a
						>
					</div>
				</nav>
				<div class="tab-content" id="nav-tabContent">
					<%- include('edit_item.ejs') %> <%- include('show_image_item.ejs') %> <%-
					include('show_activity_item.ejs') %> <%- include('show_feature_item.ejs') %>
				</div>
			</div>
			<!-- /.container-fluid -->
		</div>
		<!-- End of Main Content -->

		<%- include('../../partials/footer.ejs') %>
	</div>
	<!-- End of Content Wrapper -->
	<input type="hidden" id="itemIdToScript" value="<%= item.id %>">
</div>
<!-- End of Page Wrapper -->

<!-- Scroll to Top Button-->
<a class="scroll-to-top rounded" href="#page-top">
	<i class="fas fa-angle-up"></i>
</a>

<!-- Logout Modal-->
<div
	class="modal fade"
	id="logoutModal"
	tabindex="-1"
	role="dialog"
	aria-labelledby="exampleModalLabel"
	aria-hidden="true"
>
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
				<button class="close" type="button" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">Ã—</span>
				</button>
			</div>
			<div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
			<div class="modal-footer">
				<button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
				<a class="btn btn-primary" href="login.html">Logout</a>
			</div>
		</div>
	</div>
</div>

<%- include('../../partials/js.ejs') %>

<script>
	let itemId = document.getElementById('itemIdToScript').value;
	CKEDITOR.replace('description');
	$(document).ready(function () {
		$('table.dataTable').DataTable();
		$(".dataTable").on('click', '.btn-update-feature', function () {
			let id = $(this).data('id');
			let name = $(this).data('name');
			let qty = $(this).data('qty');
			$('#edit-modal-feature-name').val(name);
			$('#edit-modal-feature-qty').val(qty);
			$('#edit-modal-feature-form').attr("action", "/admin/item/" + itemId + "/feature/" + id +  "?_method=PUT");
		})
		$(".dataTable").on('click', '.btn-update-activity', function () {
			let id = $(this).data('id');
			let name = $(this).data('name');
			let type = $(this).data('type');
			$('#edit-modal-activity-name').val(name);
			$('#edit-modal-activity-type').val(type);
			$('#edit-modal-activity-form').attr("action", "/admin/item/" + itemId + "/activity/"+ id +"?_method=PUT");
		})
	});
	window.onload = function () {
		let active = window.location.href.split('#')[1];
		let btnActive = active ? active + '-item-tab' : 'detail-item-tab';
		let tableActive = active ? active + '-item' : 'detail-item';
		let doc = document.getElementById(btnActive);
		let fom = document.getElementById(tableActive);
		doc.setAttribute('class', 'nav-item nav-link active');
		fom.setAttribute('class', 'tab-pane fade show active');
	};
	function pushUrl(value) {
		let origin = window.location.href.split('#')[0];
		window.location.href = origin + '#' + value;
	}
</script>